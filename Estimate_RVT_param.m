function [eas_m0, mrio, PF] = Estimate_RVT_param(Tn, f_eas_hz, xf, M, Rrup)
  
       eas_m0 = 2*trapz(f_eas_hz,(2*pi*f_eas_hz).^0.*xf.^2);
        eas_m1 = 2*trapz(f_eas_hz,(2*pi*f_eas_hz).^1.*xf.^2);
         eas_m2 = 2*trapz(f_eas_hz,(2*pi*f_eas_hz).^2.*xf.^2);
           eas_m4 = 2*trapz(f_eas_hz,(2*pi*f_eas_hz).^4.*xf.^2);
           
           mrio = sqrt(eas_m2./eas_m1);
       %  Estimate root mean squared acc.
         [Dex, ~] = Estimate_Tgm_Boore_Thomson(Tn, M, Rrup,1);
%        
%         yrms = sqrt(eas_m0/Drms);
        
       % EAS of SDOF at Tn 
       % sdof_Tn =  exp(interp1(log(f_eas_hz), log(xf), log(1/Tn)));
        
       % Number of Extreme according to Eq.7
        Ne = 1/pi*sqrt(eas_m4./eas_m2)*Dex; 
% xi = 1; % Assume xi = 1 implying the harnonic response
        xi = sqrt(eas_m2^2/(eas_m0*eas_m4));
% % Estimate Peak Factor by using approximation method
        PF = sqrt(2*log(xi*Ne)) + 0.5772/(sqrt(2*log(xi*Ne))); % according to Eq.8
      
end
  
function [Dex,Drms] = Estimate_Tgm_Boore_Thomson(Tn, M, Rrup,flg_adj)
 % Given the points   
    Rps = [0 7 45 125 175 270];
    Dp = [0 2.4 8.4 10.9 17.4 34.2];
% Coefficients for the finite fault factors from Boore and Thomson (2015)
    a1 = 0.7497; b1 = 0.43; Mt1 = 5.744;
    c0 = 0.7497; c1 = 0.43; c2 = -0.04875; c3 = 0;
    a2 = 1.4147; b2 = 0.2350; Mt2 = 7.744;

    log10hM = (a1 + b1*(M-Mt1))*(M<=Mt1) + ...
              (c0 + c1*(M-Mt1) + c2*(M-Mt1)^2 + c3*(M-Mt1)^3)*(M>Mt1 & M<Mt2) + ...
              (a2 + b2*(M-Mt2))*(M>=Mt2);
    hM = 10^log10hM;
    
% Point source distance 
    Rps_int = sqrt(Rrup^2 + hM^2);

if Rps_int <=270
   Tpath = interp1(Rps, Dp, Rps_int);
else
   Tpath = Dp(Rps==270) + 0.156*(Rps_int-270);
end
% the source duration based on the two corner frequencies
    
    fa = 10^(2.181-0.496*M);
    Tsource = 0.5/fa; 
    Dex = Tsource + Tpath; 

if  flg_adj == 1     
% Correstion for oscilator 
    M_point = [2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8	2	2.5	3	3.5	4	4.5	5	5.5	6	6.5	7	7.5	8];
    R_point = [2	2	2	2	2	2	2	2	2	2	2	2	2	3.17	3.17	3.17	3.17	3.17	3.17	3.17	3.17	3.17	3.17	3.17	3.17	3.17	5.02	5.02	5.02	5.02	5.02	5.02	5.02	5.02	5.02	5.02	5.02	5.02	5.02	7.96	7.96	7.96	7.96	7.96	7.96	7.96	7.96	7.96	7.96	7.96	7.96	7.96	12.62	12.62	12.62	12.62	12.62	12.62	12.62	12.62	12.62	12.62	12.62	12.62	12.62	20	20	20	20	20	20	20	20	20	20	20	20	20	31.7	31.7	31.7	31.7	31.7	31.7	31.7	31.7	31.7	31.7	31.7	31.7	31.7	50.24	50.24	50.24	50.24	50.24	50.24	50.24	50.24	50.24	50.24	50.24	50.24	50.24	79.62	79.62	79.62	79.62	79.62	79.62	79.62	79.62	79.62	79.62	79.62	79.62	79.62	126.2	126.2	126.2	126.2	126.2	126.2	126.2	126.2	126.2	126.2	126.2	126.2	126.2	200.01	200.01	200.01	200.01	200.01	200.01	200.01	200.01	200.01	200.01	200.01	200.01	200.01	317	317	317	317	317	317	317	317	317	317	317	317	317	502.41	502.41	502.41	502.41	502.41	502.41	502.41	502.41	502.41	502.41	502.41	502.41	502.41	796.26	796.26	796.26	796.26	796.26	796.26	796.26	796.26	796.26	796.26	796.26	796.26	796.26	1262	1262	1262	1262	1262	1262	1262	1262	1262	1262	1262	1262	1262];
    
    c1  = [0.93	0.92	0.94	0.98	1.03	1.04	1.06	1.06	0.95	0.95	0.86	0.85	0.85	0.91	0.91	0.95	0.97	1.00	1.00	1.05	1.00	0.95	0.90	0.84	0.84	0.83	0.90	0.91	0.91	0.94	0.96	0.95	0.98	1.02	0.94	0.89	0.82	0.82	0.81	0.89	0.90	0.90	0.89	0.90	0.95	0.95	0.96	0.96	0.89	0.82	0.82	0.81	0.88	0.88	0.89	0.89	0.90	0.95	0.98	1.01	0.94	0.94	0.79	0.79	0.79	0.85	0.85	0.84	0.84	0.83	0.90	0.90	0.90	0.89	0.90	0.90	0.90	0.78	0.84	0.84	0.84	0.83	0.83	0.83	0.90	0.89	0.89	0.90	0.91	0.90	0.71	0.82	0.82	0.82	0.83	0.83	0.84	0.84	0.88	0.91	0.90	0.90	0.91	0.90	0.81	0.81	0.81	0.83	0.83	0.85	0.84	0.88	0.91	0.90	0.90	0.91	0.91	0.81	0.80	0.81	0.82	0.82	0.84	0.84	0.84	0.92	0.90	0.91	0.91	0.91	0.80	0.80	0.80	0.82	0.82	0.84	0.86	0.86	0.92	0.91	0.91	0.91	0.91	0.80	0.80	0.80	0.82	0.81	0.84	0.86	0.85	0.91	0.90	0.89	0.91	0.95	0.80	0.81	0.80	0.80	0.80	0.84	0.83	0.85	0.91	0.90	0.90	1.14	1.16	0.95	0.79	0.80	0.80	0.77	0.82	0.83	0.85	0.85	0.90	0.93	1.15	1.18	1.06	1.06	1.06	1.06	1.05	1.07	0.83	0.85	0.85	0.90	0.95	1.16	1.18];
    c2  = [-0.01	-0.02	-0.03	-0.06	-0.10	-0.11	-0.14	-0.14	-0.05	-0.05	0.02	0.02	0.02	-0.03	-0.04	-0.07	-0.05	-0.10	-0.09	-0.13	-0.09	-0.07	-0.02	0.03	0.03	0.04	-0.02	-0.02	-0.03	-0.04	-0.06	-0.06	-0.07	-0.12	-0.05	-0.01	0.06	0.05	0.05	-0.01	-0.02	-0.03	-0.04	-0.03	-0.07	-0.08	-0.07	-0.07	-0.01	0.06	0.05	0.05	-0.01	-0.01	-0.02	-0.04	-0.03	-0.07	-0.10	-0.13	-0.07	-0.07	0.08	0.08	0.07	0.00	0.00	0.00	-0.01	0.00	-0.06	-0.05	-0.05	-0.04	-0.04	-0.04	-0.04	0.08	0.00	-0.01	-0.01	-0.01	-0.01	-0.01	-0.06	-0.05	-0.05	-0.06	-0.06	-0.05	0.13	0.01	0.00	0.00	0.00	0.00	-0.01	-0.01	-0.04	-0.07	-0.06	-0.06	-0.06	-0.06	0.01	0.00	0.00	0.00	0.00	-0.01	-0.01	-0.04	-0.07	-0.06	-0.06	-0.06	-0.06	0.01	0.01	0.00	0.00	0.00	-0.01	-0.01	0.00	-0.07	-0.06	-0.06	-0.06	-0.06	0.01	0.01	0.01	0.00	0.00	-0.01	-0.02	-0.02	-0.07	-0.06	-0.06	-0.05	-0.06	0.01	0.01	0.01	0.01	0.02	0.00	-0.02	-0.01	-0.06	-0.04	-0.04	-0.05	-0.08	0.02	0.01	0.02	0.02	0.02	0.00	0.00	-0.01	-0.06	-0.04	-0.04	-0.29	-0.29	-0.13	0.02	0.01	0.01	0.05	0.01	0.00	-0.02	-0.01	-0.05	-0.07	-0.28	-0.31	-0.23	-0.23	-0.23	-0.24	-0.24	-0.24	0.00	-0.02	-0.01	-0.05	-0.09	-0.28	-0.31];
    c3  = [2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00	2.00];
    c4  = [1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00	1.00];
    c5  = [1.41	1.19	0.84	0.58	0.50	0.43	0.38	0.35	0.22	0.21	0.13	0.12	0.11	2.70	1.92	1.21	0.74	0.60	0.48	0.42	0.35	0.29	0.20	0.13	0.12	0.09	4.70	2.89	2.07	1.21	0.79	0.68	0.52	0.40	0.29	0.21	0.13	0.11	0.09	8.62	5.22	3.75	2.45	1.44	0.80	0.55	0.45	0.33	0.21	0.13	0.11	0.09	14.37	10.85	6.61	4.01	2.09	1.35	0.90	0.59	0.39	0.30	0.13	0.08	0.05	67.68	44.55	29.90	17.12	8.98	5.92	2.99	1.45	0.79	0.51	0.32	0.23	0.05	199.99	107.55	86.39	49.44	29.76	13.74	8.88	3.99	2.05	1.02	0.59	0.42	0.05	199.15	191.98	121.43	69.42	44.69	24.67	14.19	7.52	3.80	1.81	0.98	0.52	0.44	162.36	139.72	93.76	57.07	35.99	21.99	12.94	6.95	3.68	1.76	0.97	0.52	0.43	92.71	79.47	60.71	48.06	29.69	18.50	10.24	4.92	3.31	1.55	1.00	0.48	0.39	55.21	54.77	45.69	34.21	22.57	15.51	8.78	5.28	3.31	1.72	0.90	0.53	0.37	35.59	31.71	27.76	22.71	16.76	15.09	9.30	5.28	3.75	1.85	1.17	0.62	0.52	19.30	19.25	17.00	16.29	11.74	11.19	8.83	5.88	4.09	2.47	1.52	1.83	1.29	17.64	9.44	9.54	9.54	7.31	8.01	6.91	5.63	4.44	3.06	2.38	2.49	1.39	10.81	10.37	10.16	9.57	10.29	11.19	4.26	4.02	3.56	3.17	3.14	2.56	3.10];
    c6  = [1.90	1.89	1.91	1.89	1.85	1.79	1.76	1.72	1.77	1.77	1.88	1.88	1.82	2.06	2.03	2.10	2.05	1.99	1.90	1.84	1.73	1.76	1.78	1.88	1.89	1.87	2.03	2.06	2.04	2.08	2.04	1.92	1.81	1.81	1.78	1.80	1.89	1.92	1.90	2.04	2.06	2.07	2.05	1.95	2.06	1.97	1.88	1.84	1.85	1.89	1.95	1.89	1.97	1.98	2.11	2.16	2.06	2.15	2.07	2.00	1.88	1.87	1.94	2.11	2.28	1.83	1.85	1.88	1.87	1.85	2.30	2.14	2.03	1.94	1.92	1.92	1.91	2.56	1.76	1.70	1.77	1.81	1.80	1.86	2.32	2.16	2.11	2.04	2.00	1.88	2.85	1.45	1.52	1.53	1.64	1.70	1.86	1.87	2.11	2.20	2.17	2.07	2.06	1.85	1.47	1.52	1.57	1.64	1.73	1.91	1.85	2.11	2.18	2.15	2.07	2.05	1.87	1.48	1.51	1.56	1.68	1.68	1.84	1.85	1.91	2.14	2.12	2.01	2.11	1.98	1.54	1.56	1.61	1.67	1.69	1.81	1.94	1.92	2.12	2.09	2.07	2.03	1.98	1.54	1.56	1.60	1.66	1.60	1.77	1.84	1.90	2.16	2.09	2.12	2.27	2.08	1.55	1.64	1.59	1.56	1.60	1.77	1.78	1.89	2.11	2.11	2.16	2.33	2.17	2.00	1.60	1.62	1.54	1.51	1.74	1.75	1.85	2.00	2.26	2.05	2.45	2.42	1.97	1.94	1.94	1.96	1.96	2.07	1.62	1.83	1.94	2.25	2.59	2.52	3.15];
    c7  = [1.15	1.11	1.19	1.35	1.34	1.37	1.43	1.43	1.29	1.28	1.22	1.22	1.13	0.96	0.96	1.07	1.28	1.19	1.28	1.41	1.35	1.30	1.27	1.22	1.22	1.12	0.92	1.01	1.00	1.11	1.15	1.15	1.28	1.31	1.28	1.18	1.19	1.17	1.11	0.92	0.94	0.92	0.92	1.00	1.11	1.11	1.20	1.18	1.17	1.13	1.16	1.06	0.86	0.85	0.91	0.91	0.96	1.03	1.06	1.11	1.14	1.12	1.13	1.15	1.07	0.75	0.77	0.75	0.76	0.77	0.85	0.86	0.91	0.92	1.02	1.05	1.08	1.06	0.73	0.73	0.70	0.73	0.72	0.74	0.82	0.81	0.85	0.89	0.99	0.99	1.00	0.65	0.64	0.65	0.71	0.71	0.74	0.75	0.80	0.84	0.87	0.93	0.98	0.98	0.63	0.64	0.66	0.71	0.73	0.76	0.74	0.80	0.84	0.87	0.93	0.98	0.99	0.63	0.63	0.66	0.70	0.71	0.74	0.75	0.81	0.87	0.89	0.94	1.00	1.03	0.64	0.64	0.64	0.69	0.71	0.74	0.80	0.81	0.87	0.91	0.96	1.01	1.06	0.62	0.64	0.65	0.69	0.71	0.74	0.80	0.81	0.89	0.93	0.93	1.04	1.13	0.62	0.65	0.66	0.68	0.71	0.75	0.75	0.81	0.88	0.93	0.93	1.02	1.10	0.70	0.67	0.66	0.66	0.69	0.73	0.75	0.80	0.82	0.91	0.96	1.03	1.15	0.71	0.71	0.71	0.71	0.70	0.74	0.75	0.78	0.82	0.91	0.98	1.04	1.15];
     
    eta = Tn/Dex; damping = 0.05;
    term1 = c1 + c2.*(1 - eta.^c3)./(1 + eta.^c3);
    term2 = 1 + c4./(2*pi*damping).*(eta./(1 + c5.*eta.^c6)).^c7;
    Drms_point = term1.*term2.*Dex;
    
    % 2-D interpolation 
    % Drms = griddata(M_point, R_point, Drms_point, M, Rps_int);
    
    if Rps_int>=2
        % 2-D interpolation 
       Drms = griddata(M_point, R_point, Drms_point, M, Rps_int);
    else
       Drms = griddata(M_point, R_point, Drms_point, M, Rps_int,'nearest'); 
    end
    
    
else
       beta = 0.05;
       n = 3; % from the white paper
       alpha = 1/3; % from the white paper
       D0 = Tn/(2*pi*beta); % Oscilator duration
       gamma = Dex/Tn; % Tn is Oscilator Natural period
       Dosc = D0*(gamma^n/(gamma^n + alpha));
       Drms = Dex + Dosc;
end

end